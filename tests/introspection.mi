-- Record introspection: fields, fieldNames, tag

-- Basic record
p = Point {x = 1; y = 2; z = 3}
r1 = fields p
r2 = fieldNames p
r3 = tag p

-- ADT with named fields
Shape = {Circle r; Rect w h}
c = Circle 5
r4 = fields c
r5 = fieldNames c
r6 = tag c

rect = Rect 3 4
r7 = fields rect
r8 = fieldNames rect

-- Zero-field constructor
n = None
r9 = tag n

-- User-defined contains via introspection
contains lst x = fold (\acc el -> if (el == x) ~1 ~acc) ~0 lst
r10 = contains [1, 2, 3] 2
r11 = contains [1, 2, 3] 5

-- Contains on record field values
containsField rec x = contains (fields rec) x
r12 = containsField (Set {a = 1; b = 2; c = 3}) 2
r13 = containsField (Set {a = 1; b = 2; c = 3}) 5

-- getField: access field by name string
r14 = getField p "x"
r15 = getField p "z"

-- setField: copy with field overridden
r16 = setField p "x" 42
r17 = getField r16 "x"
r18 = getField r16 "y"

-- setField: add new field
r19 = setField p "w" 99

-- chained setField
r20 = setField (setField p "x" 10) "y" 20

-- generic mapFields using introspection
mapFields f rec = fold (\acc name -> setField acc name (f (getField acc name))) rec (fieldNames rec)
r21 = mapFields (\x -> x * 2) p
